# UFM Distribution Server - Nginx Configuration
# Place this file in /etc/nginx/sites-available/ on Goldshire
# Then symlink: sudo ln -s /etc/nginx/sites-available/ufm.conf /etc/nginx/sites-enabled/

server {
    listen 8080;
    server_name goldshire localhost;

    # UFM distribution directory
    location /ufm {
        alias /var/www/ufm;

        # Enable directory listing for debugging
        autoindex on;

        # Allow CORS for update checks
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, HEAD, OPTIONS';

        # Set correct MIME types
        types {
            application/json json;
            application/octet-stream exe;
            application/x-executable "";
        }

        # Serve version.json with JSON content type
        location ~ /ufm/version\.json$ {
            add_header Content-Type application/json;
            add_header Cache-Control "no-cache, must-revalidate";
        }

        # Large file download settings
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
    }
}
